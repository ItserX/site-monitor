# site-monitor

## Обзор проекта

Распределенная система на основе микросервисов для мониторинга доступности веб-сайтов, сбора метрик производительности и отправки оповещений в реальном времени. 

## Архитектура системы

<details>
<summary><b>Посмотреть схему архитектуры (нажмите чтобы развернуть)</b></summary>

![Диаграмма архитектуры проекта site-monitor](docs/architecture.svg)
*Рисунок 1: Общая схема взаимодействия микросервисов и компонентов мониторинга.*
</details>
### Сервисы

| Сервис | Описание | Порт | База данных |
|---------|-------------|------|----------|
| **CRUD Service** | Управляет записями адресов веб-сайтов в базе данных | 8080 | PostgreSQL |
| **Checker Service** | Выполняет проверки доступности веб-сайтов | - | - |
| **Alert Service** | Доставка оповещений | - | - |

### Стек мониторинга 

| Компонент | Назначение | Порт |
|-----------|---------|------|
| **Prometheus** | Сбор и хранение метрик | 9090 |
| **Loki** | Агрегация и хранение логов | 3100 |
| **Grafana** | Визуализация и дашборды | 3000 |
| **Promtail** | Сервис для сбора логов | - |
| **Pushgateway** | Сервис для отправки логов | 9091 |

### Базы данных

| Database | Purpose |
|----------|---------|
| **PostgreSQL** | Хранение адресов веб-сайтов |
| **Redis** | Временное хранение статусов проверок и оповещений |

## Структура проекта

```bash
.
├── cmd/                   # Точки входа приложений
│   ├── alert/             # Главный файл сервиса оповещений
│   ├── checker/           # Главный файл сервиса проверок
│   └── crud/              # Главный файл CRUD сервиса
├── configs/               # Файлы конфигурации сервисов
│   ├── alert.yaml
│   ├── checker.yaml
│   └── crud.yaml
├── internal/              # Внутренний код приложения
│   ├── alert/             # Бизнес-логика оповещений
│   ├── checker/           # Бизнес-логика проверок
│   ├── config/            # Управление конфигурацией
│   ├── crud/              # HTTP обработчики
│   ├── storage/           # Хэндлеры базы данных
│   └── telegram/          # Интеграция с Telegram
├── pkg/                   # Общие утилиты
│   ├── logger/            # Логгирование
│   ├── metrics/           # Prometheus метрики
│   └── utils/             # Общие utilities
├── migrations/            # Миграции базы данных
├── grafana/               # файлы для работы Grafana
│   └── provisioning/
│       ├── dashboards/    # Определения дашбордов
│       └── datasources/   # Конфигурации источников данных
├── docker-compose.yaml    # Полная настройка окружения
├── Dockerfile.*           # Dockerfiles сервисов
└── *.yml                  # Конфигурационные файлы мониторинга
```

## API
### CRUD Service (8080)
```bash 
GET    /sites          # Список всех веб-сайтов
GET    /sites/{id}     # Получить конкретный веб-сайт
POST   /sites          # Добавить новый веб-сайт
PUT    /sites/{id}     # Обновить веб-сайт
DELETE /sites/{id}     # Удалить веб-сайт
```

## Запуск
```bash 
cd site-monitor
docker-compose up
```
